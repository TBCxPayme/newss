<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>TBCxPayme CUP</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <h1 id="title">TBCxPayme CUP <span id="champion"></span></h1>
    <nav><a href="admin.html" class="admin-link">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</a></nav>
  </header>

  <main>
    <div id="bracket" class="bracket"></div>
  </main>

  <script>
  async function init() {
    try {
      const r = await fetch('data.json?nocache=' + Date.now());
      const data = await r.json();
      renderRounds(data.rounds);
    } catch (e) {
      const bracket = document.getElementById('bracket');
      bracket.innerHTML = '<p style="color:#ff7777">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ data.json</p>';
      console.error(e);
    }
  }

  function renderRounds(rounds){
    const bracket = document.getElementById('bracket');
    const champEl = document.getElementById('champion');
    bracket.innerHTML = '';
    champEl.textContent = '';

    const winnersByRound = [];

    rounds.forEach((round, rIdx) => {
      const roundEl = document.createElement('div'); 
      roundEl.className='round';
      const title = document.createElement('h3'); 
      title.textContent = round.name; 
      roundEl.appendChild(title);

      round.matches.forEach((m, mi) => {
        if(rIdx > 0){
          const prevWinners = winnersByRound[rIdx - 1] || [];
          const a = prevWinners[mi*2];
          const b = prevWinners[mi*2+1];
          if(a) m.teamA = m.teamA && m.teamA.toLowerCase().includes('–ø–æ–±–µ–¥') ? a : m.teamA;
          if(b) m.teamB = m.teamB && m.teamB.toLowerCase().includes('–ø–æ–±–µ–¥') ? b : m.teamB;
        }

        const matchEl = document.createElement('div'); matchEl.className='match';
        const teamA = document.createElement('div'); teamA.className='team'; teamA.textContent = `${m.teamA} (${m.scoreA})`;
        const teamB = document.createElement('div'); teamB.className='team'; teamB.textContent = `${m.teamB} (${m.scoreB})`;

        if(typeof m.scoreA === 'number' && typeof m.scoreB === 'number'){
          if(m.scoreA > m.scoreB) teamA.classList.add('winner');
          else if(m.scoreB > m.scoreA) teamB.classList.add('winner');
        }

        matchEl.appendChild(teamA); 
        matchEl.appendChild(teamB); 
        roundEl.appendChild(matchEl);
      });

      const winners = round.matches.map(m => {
        if(m.scoreA > m.scoreB) return m.teamA;
        if(m.scoreB > m.scoreA) return m.teamB;
        return null;
      });
      winnersByRound.push(winners);

      bracket.appendChild(roundEl);
    });

    const finalRound = rounds[rounds.length -1];
    if(finalRound && finalRound.matches && finalRound.matches[0]){
      const fm = finalRound.matches[0];
      if(fm.scoreA > fm.scoreB) champEl.textContent = `‚Äî ${fm.teamA} üèÜ`;
      else if(fm.scoreB > fm.scoreA) champEl.textContent = `‚Äî ${fm.teamB} üèÜ`;
    }
  }

  document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
